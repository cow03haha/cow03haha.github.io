<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <title>canvas</title>
        <script type="text/javascript">
            var cvs, ctx;
            window.onload = function(){
                cvs = document.getElementById("cvs");
                ctx = cvs.getContext("2d");
                /*
                //fill 填滿
                ctx.fillStyle = "red";
                ctx.globalAlpha = 0.5;
                ctx.fillRect(50, 50, 100, 100);
                //stroke 描邊
                ctx.strokeStyle = "blue";
                ctx.globalAlpha = 1;
                ctx.strokeRect(200, 200, 50,50);
                //path 路徑
                ctx.beginPath();
                ctx.moveTo(200, 100); //移動當前所在的位置
                ctx.lineTo(300, 300);
                ctx.closePath();
                ctx.stroke();
                //多邊形
                ctx.beginPath();
                ctx.moveTo(300, 300);
                ctx.lineTo(400, 350);
                ctx.lineTo(250, 400);
                ctx.closePath();
                ctx.fill();
                
                var img = new Image();
                img.src = "stars.png";
                img.onload = function(){
                    ctx.drawImage(this, 0, 0, cvs.width, cvs.height);
                };
                */
            }
            function invertColor(){
                var pixels = ctx.getImageData(0, 0, cvs.width, cvs.height); //ImageData 物件
                var data = pixels.data; //一個像素佔據4個資料(bytes)。r, g, b, a (範圍 0~255)
                for(var i=0;i<data.length;i+=4){
                    data[i] = 255 - data[i]; //r
                    data[i+1] = 255 - data[i+1]; //g
                    data[i+2] = 255 - data[i+2]; //b
                }
                ctx.putImageData(pixels, 0, 0);
            }
            function loadFile(input){
                var file = input.files[0];
                var src = URL.createObjectURL(file);
                var img = new Image();
                img.src = src;
                img.onload = function(){
                    ctx.drawImage(this, 0, 0, cvs.width, cvs.height);
                };
            }
            function saveFile(){
                var link = document.getElementById("download");
                link.download = "image.jpg";
                link.href = cvs.toDataURL("image/jpeg");
                link.click();
            }
        </script>
    </head>

    <body>
        <div>
            <input type="file" onchange="loadFile(this);"/>
            <input type="button" onclick="saveFile();" value="儲存檔案"/>
            <a id="download"></a>
            <input type="button" onclick="invertColor();"; value="顏色的反轉"/>
        </div>
        <canvas id="cvs" width="800" height="600" style="border: 1px solid #000000">

        </canvas>
    </body>
</html>